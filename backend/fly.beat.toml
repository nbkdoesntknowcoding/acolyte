app = "acolyte-beat"
primary_region = "bom"

[build]
  dockerfile = "Dockerfile"

# No release_command — the API service handles migrations

[env]
  ENVIRONMENT = "production"

[processes]
  beat = "celery -A app.core.celery_app beat --loglevel=info"

# No http_service — beat scheduler doesn't serve HTTP

# CRITICAL: Never scale beyond 1 machine.
# Running multiple beat instances causes duplicate scheduled tasks —
# every cron job fires N times instead of once. Fly.io may auto-scale
# by default, so we pin max to 1 here.
[[vm]]
  memory = "256mb"
  cpu_kind = "shared"
  cpus = 1
